# üöÄ H∆Ø·ªöNG D·∫™N DEPLOY ENGPRO

## T·ªïng quan ki·∫øn tr√∫c

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         PRODUCTION                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ                    VERCEL (Free Tier)                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  Client App     ‚îÇ    ‚îÇ  Admin App      ‚îÇ                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  (React/Vite)   ‚îÇ    ‚îÇ  (React/Vite)   ‚îÇ                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  engpro.vercel  ‚îÇ    ‚îÇ  engpro-admin   ‚îÇ                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ     .app        ‚îÇ    ‚îÇ  .vercel.app    ‚îÇ                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ              ‚îÇ                      ‚îÇ                             ‚îÇ
‚îÇ              ‚îÇ    HTTPS requests    ‚îÇ                             ‚îÇ
‚îÇ              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                             ‚îÇ
‚îÇ                         ‚ñº                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ              LINUX SERVER (Self-hosted)                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    ‚îÇ              Tailscale Funnel                     ‚îÇ    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    ‚îÇ         (Public HTTPS endpoint)                   ‚îÇ    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    ‚îÇ   nguyenlehuy-xxx.tail86e288.ts.net/engpro/       ‚îÇ    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                           ‚îÇ                                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    ‚îÇ           Nginx Reverse Proxy                     ‚îÇ    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    ‚îÇ              (Port 8080)                          ‚îÇ    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                           ‚îÇ                                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    ‚îÇ         PM2 Process Manager                       ‚îÇ    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    ‚îÇ   ‚îÇ  engpro-server (Node.js/Express)        ‚îÇ     ‚îÇ    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    ‚îÇ   ‚îÇ  Port: 5003                             ‚îÇ     ‚îÇ    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                             ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## PH·∫¶N 1: DEPLOY BACKEND L√äN LINUX SERVER

### 1.1. Chu·∫©n b·ªã server Linux (SSH v√†o server)

```bash
# C·∫≠p nh·∫≠t h·ªá th·ªëng
sudo apt update && sudo apt upgrade -y

# C√†i Node.js 20
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# Verify
node -v  # Ph·∫£i l√† v20.x.x
npm -v

# C√†i PM2
sudo npm install -g pm2

# C√†i Nginx
sudo apt install -y nginx

# C√†i Tailscale (n·∫øu ch∆∞a c√≥)
curl -fsSL https://tailscale.com/install.sh | sh
sudo systemctl enable --now tailscaled
```

### 1.2. T·∫°o th∆∞ m·ª•c project

```bash
# T·∫°o th∆∞ m·ª•c cho EngPro
mkdir -p ~/projects/engpro
cd ~/projects/engpro
```

### 1.3. Clone ho·∫∑c upload code backend

**C√°ch 1: D√πng Git**
```bash
git clone https://github.com/YOUR_USERNAME/EngPro.git .
cd backend
npm ci
npm run build
```

**C√°ch 2: D√πng SCP t·ª´ Mac**
```bash
# Tr√™n Mac, ch·∫°y l·ªánh n√†y
scp -r /Users/nguyenlehuy/Downloads/Clone/EngPro/backend nguyenlehuy@YOUR_LINUX_IP:~/projects/engpro/

# SSH v√†o Linux v√† c√†i dependencies
cd ~/projects/engpro/backend
npm ci
npm run build
```

### 1.4. T·∫°o file .env tr√™n server

```bash
nano ~/projects/engpro/backend/.env
```

N·ªôi dung (thay b·∫±ng gi√° tr·ªã th·ª±c):
```env
NODE_ENV=production
PORT=5003

# MongoDB
MONGODB_URI=mongodb+srv://YOUR_USERNAME:YOUR_PASSWORD@cluster.mongodb.net/engpro

# JWT
JWT_SECRET=your-super-secret-jwt-key-here
JWT_EXPIRES_IN=7d

# Frontend URLs (s·∫Ω c·∫≠p nh·∫≠t sau khi deploy Vercel)
FRONTEND_URL=https://engpro-client.vercel.app
ADMIN_URL=https://engpro-admin.vercel.app

# OpenAI (n·∫øu c√≥)
OPENAI_API_KEY=sk-xxx

# Cloudinary (n·∫øu c√≥)
CLOUDINARY_CLOUD_NAME=xxx
CLOUDINARY_API_KEY=xxx
CLOUDINARY_API_SECRET=xxx

# PayOS (n·∫øu c√≥)
PAYOS_CLIENT_ID=xxx
PAYOS_API_KEY=xxx
PAYOS_CHECKSUM_KEY=xxx

# Email (n·∫øu c√≥)
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=xxx@gmail.com
EMAIL_PASS=xxx
```

### 1.5. C·∫•u h√¨nh PM2

```bash
mkdir -p ~/server
nano ~/server/ecosystem.config.js
```

N·ªôi dung:
```javascript
module.exports = {
  apps: [
    {
      name: 'engpro-server',
      script: 'dist/server.js',
      cwd: '/home/nguyenlehuy/projects/engpro/backend',
      env: {
        PORT: 5003,
        NODE_ENV: 'production'
      },
      instances: 1,
      autorestart: true,
      watch: false,
      max_memory_restart: '500M',
      error_file: '/home/nguyenlehuy/logs/engpro-error.log',
      out_file: '/home/nguyenlehuy/logs/engpro-out.log',
      log_file: '/home/nguyenlehuy/logs/engpro-combined.log',
      time: true
    }
  ]
};
```

```bash
# T·∫°o th∆∞ m·ª•c logs
mkdir -p ~/logs

# Kh·ªüi ƒë·ªông PM2
cd ~/server
pm2 start ecosystem.config.js
pm2 list
pm2 logs engpro-server --lines 50

# Setup auto-start
pm2 startup systemd
# Ch·∫°y l·ªánh m√† PM2 in ra (d·∫°ng: sudo env PATH=...)
pm2 save
```

### 1.6. C·∫•u h√¨nh Nginx

```bash
sudo nano /etc/nginx/nginx.conf
```

Th√™m v√†o trong block `http { ... }`:
```nginx
server_names_hash_bucket_size 128;
```

T·∫°o file config:
```bash
sudo nano /etc/nginx/sites-available/engpro
```

N·ªôi dung:
```nginx
# Server block cho Tailscale Funnel (HTTP port 8080)
server {
    listen 8080;
    server_name nguyenlehuy-vivobook-asuslaptop-x512fa-a512fa.tail86e288.ts.net;

    # EngPro API
    location /engpro/ {
        proxy_pass http://127.0.0.1:5003/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;
        
        # WebSocket support (cho Socket.IO)
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 300s;
        proxy_connect_timeout 75s;
    }

    # Root
    location / {
        return 200 "EngPro Server is running!\n\nAccess API at: /engpro/\n";
        add_header Content-Type text/plain;
    }
}
```

Enable v√† reload:
```bash
sudo ln -s /etc/nginx/sites-available/engpro /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
sudo systemctl enable nginx
```

### 1.7. Setup Tailscale Funnel

```bash
# T·∫Øt funnel c≈© n·∫øu c√≥
sudo tailscale funnel off

# B·∫≠t Tailscale Funnel (HTTPS 443 -> HTTP 8080)
sudo tailscale funnel --bg --https=443 http://127.0.0.1:8080
tailscale funnel status
```

### 1.8. Test API

```bash
# Test local
curl http://localhost:5003/health
curl http://localhost:8080/engpro/health

# Test public (t·ª´ Mac/ƒëi·ªán tho·∫°i)
curl https://nguyenlehuy-vivobook-asuslaptop-x512fa-a512fa.tail86e288.ts.net/engpro/health
```

---

## PH·∫¶N 2: DEPLOY FRONTEND L√äN VERCEL

### 2.1. Chu·∫©n b·ªã Frontend Client

T·∫°o file `vercel.json` trong `frontend/client`:

```json
{
  "framework": "vite",
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "rewrites": [
    { "source": "/(.*)", "destination": "/" }
  ]
}
```

C·∫≠p nh·∫≠t file `.env.production` trong `frontend/client`:

```env
VITE_API_URL=https://nguyenlehuy-vivobook-asuslaptop-x512fa-a512fa.tail86e288.ts.net/engpro
```

### 2.2. Chu·∫©n b·ªã Frontend Admin

T·∫°o file `vercel.json` trong `frontend/admin`:

```json
{
  "framework": "vite",
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "rewrites": [
    { "source": "/(.*)", "destination": "/" }
  ]
}
```

C·∫≠p nh·∫≠t file `.env.production` trong `frontend/admin`:

```env
VITE_API_URL=https://nguyenlehuy-vivobook-asuslaptop-x512fa-a512fa.tail86e288.ts.net/engpro
```

### 2.3. Deploy l√™n Vercel

**B∆∞·ªõc 1: C√†i Vercel CLI**
```bash
npm install -g vercel
```

**B∆∞·ªõc 2: Deploy Client App**
```bash
cd frontend/client
vercel login  # ƒêƒÉng nh·∫≠p b·∫±ng GitHub/GitLab/Email

# Deploy production
vercel --prod

# Vercel s·∫Ω h·ªèi:
# - Set up and deploy? Yes
# - Which scope? (Ch·ªçn account c·ªßa b·∫°n)
# - Link to existing project? No
# - What's your project's name? engpro-client
# - In which directory is your code located? ./
# - Want to override settings? No
```

**B∆∞·ªõc 3: Deploy Admin App**
```bash
cd ../admin
vercel --prod

# Project name: engpro-admin
```

### 2.4. C·∫•u h√¨nh Environment Variables tr√™n Vercel Dashboard

1. V√†o https://vercel.com/dashboard
2. Ch·ªçn project `engpro-client`
3. V√†o **Settings** ‚Üí **Environment Variables**
4. Th√™m:
   - `VITE_API_URL` = `https://nguyenlehuy-vivobook-asuslaptop-x512fa-a512fa.tail86e288.ts.net/engpro`

5. L√†m t∆∞∆°ng t·ª± cho `engpro-admin`

### 2.5. C·∫≠p nh·∫≠t CORS tr√™n Backend

Sau khi c√≥ URL Vercel, c·∫≠p nh·∫≠t file `.env` tr√™n server Linux:

```bash
nano ~/projects/engpro/backend/.env
```

```env
FRONTEND_URL=https://engpro-client.vercel.app
```

C≈©ng c·∫ßn c·∫≠p nh·∫≠t CORS trong `server.ts` n·∫øu c·∫ßn th√™m domain:

```typescript
// Trong server.ts, th√™m domain Vercel v√†o CORS
cors({
    origin: [
        process.env.FRONTEND_URL || "http://localhost:5173",
        "https://engpro-client.vercel.app",
        "https://engpro-admin.vercel.app",
        // ... c√°c origin kh√°c
    ],
    credentials: true,
})
```

Sau ƒë√≥ restart server:
```bash
cd ~/projects/engpro/backend
git pull  # ho·∫∑c upload l·∫°i code
npm run build
pm2 restart engpro-server
```

---

## PH·∫¶N 3: SETUP CI/CD V·ªöI GITHUB ACTIONS

### 3.1. T·∫°o Self-hosted Runner tr√™n Linux

```bash
# T·∫°o th∆∞ m·ª•c
mkdir -p ~/github-runners/engpro
cd ~/github-runners/engpro

# Download runner (l·∫•y link t·ª´ GitHub Settings -> Actions -> Runners)
curl -o actions-runner-linux-x64-2.329.0.tar.gz -L https://github.com/actions/runner/releases/download/v2.329.0/actions-runner-linux-x64-2.329.0.tar.gz

# Gi·∫£i n√©n
tar xzf ./actions-runner-linux-x64-2.329.0.tar.gz

# C·∫•u h√¨nh (l·∫•y token t·ª´ GitHub)
./config.sh --url https://github.com/YOUR_USERNAME/EngPro --token YOUR_GITHUB_TOKEN

# C√†i nh∆∞ service
sudo ./svc.sh install
sudo ./svc.sh start
sudo ./svc.sh status
```

### 3.2. T·∫°o GitHub Actions Workflow

T·∫°o file `.github/workflows/deploy.yml`:

```yaml
name: Deploy EngPro

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  deploy-backend:
    runs-on: self-hosted
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check Node version
        run: |
          echo "=== Node & NPM Versions ==="
          node -v
          npm -v

      - name: Install backend dependencies
        run: |
          cd backend
          npm ci

      - name: Build backend
        run: |
          cd backend
          npm run build

      - name: Restart backend with PM2
        run: |
          cd backend
          pm2 restart engpro-server || pm2 start dist/server.js --name engpro-server
          pm2 save

  # Frontend auto-deploy qua Vercel Git Integration
  # Kh√¥ng c·∫ßn job deploy-frontend v√¨ Vercel t·ª± ƒë·ªông build khi push

  notify:
    runs-on: self-hosted
    needs: [deploy-backend]
    if: always()
    steps:
      - name: Deployment status
        run: |
          if [ "${{ needs.deploy-backend.result }}" == "success" ]; then
            echo "‚úÖ Backend deployment successful!"
          else
            echo "‚ùå Backend deployment failed!"
            exit 1
          fi
```

### 3.3. C·∫•u h√¨nh Vercel Git Integration (Auto-deploy Frontend)

1. V√†o https://vercel.com/dashboard
2. Ch·ªçn project ‚Üí **Settings** ‚Üí **Git**
3. Connect v·ªõi GitHub repo
4. M·ªói khi push code, Vercel s·∫Ω t·ª± ƒë·ªông build v√† deploy

---

## PH·∫¶N 4: KI·ªÇM TRA H·ªÜ TH·ªêNG

### 4.1. Ki·ªÉm tra Backend (SSH v√†o Linux)

```bash
pm2 list                  # engpro-server: online
sudo systemctl status nginx
tailscale funnel status
curl http://localhost:5003/health
curl https://YOUR_TAILSCALE_URL/engpro/health
```

### 4.2. Ki·ªÉm tra Frontend

- Client: https://engpro-client.vercel.app
- Admin: https://engpro-admin.vercel.app

### 4.3. Test sau reboot

```bash
sudo reboot
# ƒê·ª£i 2 ph√∫t, SSH l·∫°i

pm2 list  # Ph·∫£i th·∫•y engpro-server online
sudo systemctl status nginx
tailscale funnel status

# N·∫øu funnel kh√¥ng t·ª± b·∫≠t, ch·∫°y l·∫°i:
sudo tailscale funnel --bg --https=443 http://127.0.0.1:8080
```

---

## CHECKLIST HO√ÄN TH√ÄNH

- [ ] Node.js 20 c√†i ƒë·∫∑t th√†nh c√¥ng
- [ ] Backend build th√†nh c√¥ng
- [ ] PM2 ch·∫°y engpro-server (port 5003)
- [ ] Nginx config v√† ho·∫°t ƒë·ªông
- [ ] Tailscale Funnel public HTTPS
- [ ] Test API health check th√†nh c√¥ng
- [ ] Vercel deploy client th√†nh c√¥ng
- [ ] Vercel deploy admin th√†nh c√¥ng
- [ ] CORS c·∫•u h√¨nh ƒë√∫ng
- [ ] GitHub Actions runner online
- [ ] CI/CD workflow ho·∫°t ƒë·ªông
- [ ] Test sau reboot th√†nh c√¥ng

---

## L·ªÜNH QU·∫¢N L√ù H·ªÆU √çCH

### Xem logs
```bash
pm2 logs engpro-server --lines 100
sudo journalctl -u nginx -f
```

### Restart services
```bash
pm2 restart engpro-server
sudo systemctl restart nginx
```

### Stop services
```bash
pm2 stop engpro-server
sudo systemctl stop nginx
sudo tailscale funnel off
```

### Redeploy backend
```bash
cd ~/projects/engpro/backend
git pull origin main
npm ci
npm run build
pm2 restart engpro-server
```